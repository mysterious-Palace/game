<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width,user-scalable=no" name="viewport">
    <title>mysterious Palace</title>
    <script src="/game/js/Base64.js"></script>
    <link type="text/css" rel="styleSheet"  href="/game/css/main.css" />
    <!--<embed src="mp3\main.mp3" hidden="true" autostart="true" loop="true" />-->
  </head>
  <script>
    var xiaoxi_="";
    var base = new Base64();
    var archive = { //初始数据
      "x":1,          // 坐标x
      "y":20,         // 坐标y
      "HP":100,       // 血量
      "ATK":10,       // 攻击力
      "DEF":10,       // 防御力
      "FirstKey":0,   // 1号钥匙
      "SecondKey":0,  // 2号钥匙
      "ThirdKey":0,   // 3号钥匙
      "Weapons":0,    // 武器
      "Armor":0,      // 防具
      "GOLD":0,       // 金钱
      "tf":2,         // 天赋
      "gk":1,         // 关卡
    };
  </script>
<script src="/game/js/init.js"></script>
<script>//js数据导入
  document.write("<script src=\"/game/js/map/"+archive["gk"]+".js\"><\/script>");//地图导入
  document.write("<script src=\"/game/js/gk/"+archive["gk"]+".js\"><\/script>");//判断代码导入
</script>
<div id="bian" style="border:1px solid #96C2F1; background-color:#EFF7FF; position:absolute; left:5px; top:5px; overflow:hidden; width:260px; height:460px;"></div>
<div id="xiaoxi_" style="border:1px solid #96C2F1; background-color:#EFF7FF; position:absolute; left:725px; top:5px; overflow:hidden; width:250px; height:460px;">
  <h3>&nbsp;消息栏</h3>
</div>
<script>//地图模块
  function pd()
  {
    for(var i=archive["x"]-7,X=0;i<=archive["x"]+7;i++,X++)
      for(var j=archive["y"]-7,Y=0;j<=archive["y"]+7;j++,Y++)
        if(i>=0&&i<37&&j>=0&&j<119)
        {
          if(i==archive["x"]&&j==archive["y"])
            document.getElementById(String(X*15+Y)).innerHTML = 
              "<img src=\"/file/img/mpgame/reng.png\" width=\"30\" height=\"30\" />";
          else if(map[i][j]=='#')
             document.getElementById(String(X*15+Y)).innerHTML = 
              "<img src=\"/file/img/mpgame/qiang.png\" width=\"30\" height=\"30\" />";
          else if(map[i][j]==' ')
            document.getElementById(String(X*15+Y)).innerHTML = 
              "<img src=\"/file/img/mpgame/bai.png\" width=\"30\" height=\"30\" />";
          else if(map[i][j]=='1')
            document.getElementById(String(X*15+Y)).innerHTML = 
              "<img src=\"/file/img/mpgame/yaoshi1.png\" width=\"30\" height=\"30\" />";
          else if(map[i][j]=='2')
            document.getElementById(String(X*15+Y)).innerHTML = 
              "<img src=\"/file/img/mpgame/yaoshi2.png\" width=\"30\" height=\"30\" />";
          else if(map[i][j]=='3')
            document.getElementById(String(X*15+Y)).innerHTML = 
              "<img src=\"/file/img/mpgame/yaoshi3.png\" width=\"30\" height=\"30\" />";
          else
            document.getElementById(String(X*15+Y)).innerHTML = 
              "<img src=\"/file/img/mpgame/"/*暂无图标*/+String(map[i][j])+".png\" width=\"30\" height=\"30\" />";
        }
        else
          document.getElementById(String(X*15+Y)).innerHTML = 
            "<img src=\"/file/img/mpgame/qiang.png\" width=\"30\" height=\"30\" />";
    document.getElementById("bian").innerHTML = 
      "<button type=\"button\" class=\"button\" onclick=\"drcd()\">导入存档</button>"+
      "<button type=\"button\" class=\"button\" onclick=\"dccd()\">导出存档</button>"+
      "<br/>"+
      "<h3>&nbsp;状态栏</h3>";
    document.getElementById("bian").innerHTML +=
      "&nbsp;<b>行</b>:"+String(archive["x"])+" <b>列</b>:"+String(archive["y"])+"<br/>";
    document.getElementById("bian").innerHTML +=
      "&nbsp;<b>HP</b>:"+String(archive["HP"])+"<br/>";
    document.getElementById("bian").innerHTML +=
      "&nbsp;<b>ATK</b>:"+String(archive["ATK"])+"<br/>";
    document.getElementById("bian").innerHTML +=
      "&nbsp;<b>DEF</b>:"+String(archive["DEF"])+"<br/>";
    document.getElementById("bian").innerHTML +=
      "&nbsp;<b>FirstKey</b>:"+String(archive["FirstKey"])+"<br/>";
    document.getElementById("bian").innerHTML +=
      "&nbsp;<b>SecondKey</b>:"+String(archive["SecondKey"])+"<br/>";
    document.getElementById("bian").innerHTML +=
      "&nbsp;<b>ThirdKey</b>:"+String(archive["ThirdKey"])+"<br/>";
    document.getElementById("bian").innerHTML +=
      "&nbsp;<b>Weapons</b>:"+String(archive["Weapons"])+"<br/>";
    document.getElementById("bian").innerHTML +=
      "&nbsp;<b>Armor</b>:"+String(archive["Armor"])+"<br/>";
    document.getElementById("bian").innerHTML +=
      "&nbsp;<b>GOLD</b>:"+String(archive["GOLD"])+"<br/>";
  }
  pd();
</script>
<script>//开始模块
  function dccd()//导出存档
  {
    document.getElementById("bian").innerHTML = 
      "<button type=\"button\" class=\"button\" onclick=\"drcd()\">导入存档</button>"
      +"<button type=\"button\" class=\"button\" onclick=\"dccd()\">导出存档</button>"
      +"<br/><br/>"
      +"<textarea rows=\"10\" cols=\"30\" id=\"cd\" style=\"position:absolute; left:5px; top:45px;\">"
      +base.encode(JSON.stringify(archive))
      +"</textarea><br/>"
      +"<input type=\"button\" onClick=\"fz()\" value=\"点击复制代码\" style=\"position:absolute; left:5px; top:220px;\"/>"
      +"<input type=\"button\" onClick=\"pd()\" value=\"关闭复制框\" style=\"position:absolute; left:105px; top:220px;\"/><br/>";
  };
  function drcd()//导入存档
  {
    archive = JSON.parse(base.decode(prompt("请导入存档","")));
    xiaoxi('你导入了存档!',"PS");
    pd();
    //document.write(JSON.stringify(archive));
  };
  function fz()//复制存档
  {
    var Url2=document.getElementById("cd");
    Url2.select();
    document.execCommand("Copy");
    alert("复制完成！");
  };
  function xiaoxi(str,pngurl)//发送消息
  {
    xiaoxi_="&nbsp;<img src=\"png/"+pngurl+".png\" width=\"20\" height=\"20\" />："+str+"<br/>\n"+xiaoxi_;
    document.getElementById("xiaoxi_").innerHTML =
     "<h3>&nbsp;消息栏</h3>"+xiaoxi_;
  };
</script>
<script>//上下左右操作
  document.onkeydown=function(e){
    e=window.event||e;
    switch(e.keyCode){
      case 37: //左键（←）
        caozuo('zuo');
        break;
      case 38: //向上键（↑）
        caozuo('shang');
        break;
      case 39: //右键（→）
        caozuo('you');
        break;
      case 40: //向下键（↓）
        caozuo('xia');
        break;
      case 65: //左键（a）
        caozuo('zuo');
        break;
      case 87: //向上键（w）
        caozuo('shang');
        break;
      case 68: //右键（d）
        caozuo('you');
        break;
      case 83: //向下键（s）
        caozuo('xia');
        break;
      default:
        //xiaoxi("你按了"+String(e.keyCode),"PS");
        break;
    }
  }
</script>
<button type="button" onclick="caozuo('shang')" style="position:absolute;padding: 15px 21px;right:87px;bottom:115px;width:80px;height:53px;">上</button>
<button type="button" onclick="caozuo('xia')" style="position:absolute;padding: 15px 21px;right:87px;bottom:5px;width:80px;height:53px;">下</button>
<button type="button" onclick="caozuo('zuo')" style="position:absolute;padding: 15px 21px;right:169px;bottom:60px;width:80px;height:53px;">左</button>
<button type="button" onclick="caozuo('you')" style="position:absolute;padding: 15px 21px;right:5px;bottom:60px;width:80px;height:53px;">右</button>
<button type="button" onclick="caozuo('zhong')" style="position:absolute;padding: 15px 21px;right:87px;bottom:60px;width:80px;height:53px;">技能</button>
</html>
